# Benchmarking Acorn-128 encrypt/ decrypt kernel on Intel Arria 10 FPGA

I've implemented single work-item Acorn-128 encrypt/ decrypt FPGA kernels, which can be used for computing encrypted text using Acorn-128 authenticated encryption algorithm/ decrypted text using Acorn-128 verified decryption algorithm on N -many different, independent & non-overlapping plain/ cipher text byteslices & respective associated data byteslices. N -many invocations of Acorn-128 encrypt/ decrypt routine are not spawn in well familiar multi work-item data-parallel fashion, instead single work-item kernel's iterative execution style is preferred, while leveraging deep pipelining.

In following setting associated data length is kept same ( = 32 -bytes ), while plain/ cipher text length is chosen to be power of 2, from range [64..4096] ( read both ends are included ). Number of times iteration is executed inside body of single work-item kernel ( i.e. N ) âˆˆ {2^16, 2^17, 2^18}.

## Job submission

Intel Devcloud is used for submission of FPGA h/w synthesis & h/w image execution jobs.

### Compilation

First prepare job submission script like

```bash
touch build_fpga_bench_hw.sh
```

Put following content inside job submission script

```bash
#!/bin/bash

# file name: build_fpga_bench_hw.sh

# env setup
export PATH=/glob/intel-python/python2/bin/:${PATH}
source /opt/intel/inteloneapi/setvars.sh > /dev/null 2>&1

# hardware compilation
time make fpga_hw_bench
```

Then enqueue job to generate h/w image on `fpga_compile` tagged VM on Intel Devcloud.

```bash
qsub -l nodes=1:fpga_compile:ppn=2 -l walltime=24:00:00 -d . build_fpga_bench_hw.sh
```

Successful submission should generate job id ( looks like `1882236` ), take a note of it.

### Execution

Once FPGA h/w synthesis is finished, another dependent job will kick in to execute synthesized h/w image & collect benchmark metrics.

First prepare job submission script

```bash
touch run_fpga_bench_hw.sh
```

Put following content inside that script

```bash
#!/bin/bash

# file name: run_fpga_bench_hw.sh

# env setup
export PATH=/glob/intel-python/python2/bin/:${PATH}
source /opt/intel/inteloneapi/setvars.sh > /dev/null 2>&1

# hardware image execution
pushd bench; ./fpga_hw_bench.out; popd
```

Now create job dependency graph, using compilation job id, when submitting execution job.

```bash
qsub -l nodes=1:fpga_runtime:arria10:ppn=2 -d . run_fpga_bench_hw.sh -W depend=afterok:1882236
```

Execution job submission should also generate one job id, though we don't need it at this moment.

> Read more about job submission using `qsub` on Intel Devcloud [here](https://devcloud.intel.com/oneapi/documentation/job-submission)

## Results

### Acorn-128 Authenticated Encryption

```bash
running on pac_a10 : Intel PAC Platform (pac_ee00000)

Benchmarking Acorn-128 encrypt

+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|invocation count|plain text len ( bytes )|associated data len ( bytes )|host-to-device b/w|      kernel b/w|device-to-host b/w|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                      64|                           32|    2.558604 GB/ s|425.461427 MB/ s|    2.769006 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                     128|                           32|    2.850017 GB/ s|709.551687 MB/ s|    3.595292 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                     256|                           32|    3.692869 GB/ s|929.172437 MB/ s|    4.125499 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                     512|                           32|    4.142135 GB/ s|891.492840 MB/ s|    4.325855 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                    1024|                           32|    4.645160 GB/ s|872.121752 MB/ s|    4.603021 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                    2048|                           32|    5.280064 GB/ s|862.316127 MB/ s|    5.156426 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                    4096|                           32|    5.618515 GB/ s|857.424654 MB/ s|    5.802540 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                      64|                           32|    3.127791 GB/ s|426.003948 MB/ s|    3.577710 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                     128|                           32|    3.677781 GB/ s|710.015151 MB/ s|    3.983279 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                     256|                           32|    4.121820 GB/ s|929.583027 MB/ s|    4.225054 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                     512|                           32|    4.488197 GB/ s|891.635628 MB/ s|    4.678194 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                    1024|                           32|    5.014401 GB/ s|872.236127 MB/ s|    4.972520 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                    2048|                           32|    5.524890 GB/ s|862.397592 MB/ s|    5.777583 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                    4096|                           32|    5.866620 GB/ s|857.446016 MB/ s|    6.040561 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                      64|                           32|    4.024216 GB/ s|426.126437 MB/ s|    4.031486 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                     128|                           32|    4.300845 GB/ s|710.232632 MB/ s|    4.324509 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                     256|                           32|    4.489159 GB/ s|929.815090 MB/ s|    4.704112 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                     512|                           32|    5.036909 GB/ s|891.753691 MB/ s|    4.937603 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                    1024|                           32|    5.560569 GB/ s|872.267408 MB/ s|    5.788664 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                    2048|                           32|    5.848385 GB/ s|862.414131 MB/ s|    6.086437 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                    4096|                           32|    6.001713 GB/ s|857.462845 MB/ s|    6.277047 GB/ s|
+----------------+------------------------+-----------------------------+------------------+----------------+------------------+
```

### Acorn-128 Verified Decryption

```bash
running on pac_a10 : Intel PAC Platform (pac_ee00000)

Benchmarking Acorn-128 decrypt

+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|invocation count|cipher text len ( bytes )|associated data len ( bytes )|host-to-device b/w|      kernel b/w|device-to-host b/w|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                       64|                           32|    2.451160 GB/ s|425.686188 MB/ s|    3.408183 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                      128|                           32|    3.056343 GB/ s|709.628171 MB/ s|    4.017520 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                      256|                           32|    3.602670 GB/ s|929.296538 MB/ s|    4.328738 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                      512|                           32|    4.036595 GB/ s|891.521453 MB/ s|    4.582978 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                     1024|                           32|    4.481731 GB/ s|872.141908 MB/ s|    4.715892 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                     2048|                           32|    5.046250 GB/ s|862.348983 MB/ s|    5.398996 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|65536           |                     4096|                           32|    5.597468 GB/ s|857.428788 MB/ s|    5.829075 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                       64|                           32|    3.034016 GB/ s|425.976018 MB/ s|    4.009781 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                      128|                           32|    3.641145 GB/ s|710.019763 MB/ s|    4.364245 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                      256|                           32|    4.030152 GB/ s|929.659580 MB/ s|    4.584923 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                      512|                           32|    4.380053 GB/ s|891.665722 MB/ s|    4.961476 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                     1024|                           32|    5.061121 GB/ s|872.221384 MB/ s|    5.388472 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                     2048|                           32|    5.462505 GB/ s|862.395303 MB/ s|    5.886414 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|131072          |                     4096|                           32|    5.799496 GB/ s|857.452152 MB/ s|    6.048589 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                       64|                           32|    3.899673 GB/ s|426.118220 MB/ s|    4.378548 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                      128|                           32|    4.242685 GB/ s|710.219038 MB/ s|    4.596181 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                      256|                           32|    4.374081 GB/ s|929.834267 MB/ s|    4.711705 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                      512|                           32|    4.883741 GB/ s|891.763608 MB/ s|    5.133492 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                     1024|                           32|    5.507236 GB/ s|872.269468 MB/ s|    5.795143 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                     2048|                           32|    5.793955 GB/ s|862.417241 MB/ s|    6.059330 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
|262144          |                     4096|                           32|    5.974825 GB/ s|857.462308 MB/ s|    6.291358 GB/ s|
+----------------+-------------------------+-----------------------------+------------------+----------------+------------------+
```
